function [U,M3] = ARMA_output_QQ( Qq,mm)
%UNTITLED17 此处显示有关此函数的摘要

%[ QQ ] = QQ_jisuan( DATA );
%%
%%%%%降维部分代码%%%%%%%
% Xxx = QQ(1:3,:); %选取需要降维的几个关节点
% 
% [newXxx,T,meanValue,cols] = pca_row(Xxx,0.90);
% % G = diff(newX);%修改处，可注释 
% M=newXxx*T'+meanValue  %还原原始数据
% C = newXxx;
%%
%%%%%%%%%ARMA模型建立部分%%%%%%%%
C = Qq(:,mm);

%---------------------预处理----------------------
adf1=adftest(C);           %判断平稳性
%df1=diff(C);
df1 = diff(C,1);
% df1 = C;          %修改处
adf2=adftest(df1);
ljz=df1-mean(df1);%零均值  Q1:ARMA建模这里需不需要零均值？
u = iddata(ljz); %转换到频域即数据转换为armax模型可识别类
%-----------------------预处理-------------------------
%-------------------AIC确定阶数-------------------
test = [];
for p = 0:5                  
for q = 0:5             %修改处
m = armax(u,[p q]);
AIC = aic(m);              %armax(p,q),计算AIC，返回模型m对应的AIC
test = [test;p q AIC];
end
end
for k = 1:size(test,1)
if test(k,3) == min(test(:,3)) %选择AIC值最小的模型
p_test = test(k,1);
q_test = test(k,2);
break;
end
end
%--------------------AIC确定阶数-------------------
%--------------------armax建模--------------------
% figure(1)
 m = armax(u,[p_test q_test]);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
% e = resid(m,u);        %求残差
% plot(e);
% hold on
% ue=get(e,'outputData');
% lbq1=lbqtest(ue)       % 残差检验 
%-------------------armax建模--------------------
%-----------------预测--------------------
% figure(2)
%compare(u,m,1)        %Q3：compare函数与predict函数有什么区别？  
m3 = predict(m,u,1);

% num = printf('%d\n',m3)
%subplot(3,1,1)
 plot(u(1:end),'r-',m3(1:end),'--')
axis([0 700 -20 20]);
set(gca,'FontSize',14);
grid on
% title('第221-292帧')
legend('Measurement sequence','Fitting sequence')
U = u.outputdata;
M3= m3.outputdata;       %提取真实数据和预测数据


%------------------预测---------------
%----------------arima-------------
m1=arima(p_test,0,q_test)
% ima=estimate(m1,ljz) %Q4:这里建模得到的参数为啥与ARMAX得到的不一致？


end

